<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Comments Moderation - Gisu Safaris</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f6f7fb; }
    .card { border: 0; box-shadow: 0 4px 14px rgba(0,0,0,.06); }
    .table td, .table th { vertical-align: middle; }
    .wrap { white-space: pre-wrap; }
    .pointer { cursor: pointer; }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg bg-white border-bottom">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold" href="#">Gisu Safaris Admin</a>
      <span class="navbar-text">Comments Moderation</span>
    </div>
  </nav>

  <div class="container py-4">
    <div class="row g-3">
      <div class="col-12">
        <div class="card">
          <div class="card-body">
            <div class="row g-3 align-items-end">
              <div class="col-md-3">
                <label class="form-label">API Key</label>
                <input type="password" id="apiKey" class="form-control" placeholder="Enter API key" />
                <div class="form-text">Stored locally in your browser.</div>
              </div>
              <div class="col-md-3">
                <label class="form-label">Status</label>
                <select id="status" class="form-select">
                  <option value="pending" selected>pending</option>
                  <option value="approved">approved</option>
                  <option value="rejected">rejected</option>
                </select>
              </div>
              <div class="col-md-3">
                <label class="form-label">Page Path (optional)</label>
                <input type="text" id="page" class="form-control" placeholder="/blog/example.html" />
              </div>
              <div class="col-md-3">
                <label class="form-label">Search</label>
                <input type="text" id="q" class="form-control" placeholder="keyword" />
              </div>
              <div class="col-12 d-flex gap-2">
                <button id="saveKey" class="btn btn-outline-secondary">Save API Key</button>
                <button id="loadBtn" class="btn btn-primary">Load</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-12">
        <div class="card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h5 class="mb-0">Comments</h5>
              <div class="text-muted small" id="summary"></div>
            </div>
            <div class="table-responsive">
              <table class="table table-sm align-middle" id="tbl">
                <thead>
                  <tr>
                    <th>Time</th>
                    <th>Page</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Comment</th>
                    <th>Consent</th>
                    <th>Status</th>
                    <th class="text-end">Actions</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_LIST = '/backend/api/comments_moderate.php';

    function $(sel){ return document.querySelector(sel); }
    function el(tag, attrs={}, children=[]) {
      const n = document.createElement(tag);
      for (const [k,v] of Object.entries(attrs)) {
        if (k === 'class') n.className = v; else if (k === 'text') n.textContent = v; else n.setAttribute(k, v);
      }
      children.forEach(c => n.appendChild(c));
      return n;
    }

    function getKey(){ return localStorage.getItem('gisu_admin_api_key') || ''; }
    function setKey(k){ localStorage.setItem('gisu_admin_api_key', k); }

    async function loadComments() {
      const tbody = $('#tbl tbody');
      tbody.innerHTML = '<tr><td colspan="8" class="text-center text-muted py-4">Loading...</td></tr>';
      const params = new URLSearchParams();
      const status = $('#status').value.trim();
      const page = $('#page').value.trim();
      const q = $('#q').value.trim();
      if (status) params.set('status', status);
      if (page) params.set('page', page);
      if (q) params.set('q', q);

      const res = await fetch(API_LIST + '?' + params.toString(), { headers: { 'X-API-Key': getKey() } });
      const json = await res.json().catch(()=>({}));
      if (!res.ok || !json?.success) {
        tbody.innerHTML = '<tr><td colspan="8" class="text-center text-danger py-4">Failed to load comments</td></tr>';
        return;
      }
      const rows = Array.isArray(json.data?.comments) ? json.data.comments : [];
      $('#summary').textContent = rows.length + ' result(s)';
      if (!rows.length) {
        tbody.innerHTML = '<tr><td colspan="8" class="text-center text-muted py-4">No results</td></tr>';
        return;
      }

      tbody.innerHTML = '';
      rows.forEach(r => {
        const tr = document.createElement('tr');
        tr.appendChild(el('td', { class: 'text-nowrap', text: new Date(r.created_at).toLocaleString() }));
        tr.appendChild(el('td', { class: 'small', text: r.page_path }));
        tr.appendChild(el('td', { text: r.name || 'Anonymous' }));
        tr.appendChild(el('td', { class: 'small', text: r.email || '' }));
        tr.appendChild(el('td', {}, [ el('div', { class: 'wrap small' , text: r.comment }) ]));
        tr.appendChild(el('td', { text: r.consent ? 'Yes' : 'No' }));
        tr.appendChild(el('td', { text: r.status }));
        const actions = el('td', { class: 'text-end' });
        const approveBtn = el('button', { class: 'btn btn-sm btn-success me-1' }); approveBtn.textContent = 'Approve';
        const rejectBtn = el('button', { class: 'btn btn-sm btn-outline-danger' }); rejectBtn.textContent = 'Reject';
        approveBtn.addEventListener('click', ()=> moderate(r.id, 'approve'));
        rejectBtn.addEventListener('click', ()=> moderate(r.id, 'reject'));
        if (r.status === 'approved') { approveBtn.disabled = true; }
        if (r.status === 'rejected') { rejectBtn.disabled = true; }
        actions.appendChild(approveBtn);
        actions.appendChild(rejectBtn);
        tr.appendChild(actions);
        tbody.appendChild(tr);
      });
    }

    async function moderate(id, action) {
      if (!confirm('Are you sure to ' + action + ' this comment?')) return;
      const res = await fetch(API_LIST, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'X-API-Key': getKey() },
        body: JSON.stringify({ id, action })
      });
      const json = await res.json().catch(()=>({}));
      if (!res.ok || !json?.success) {
        alert('Failed to update comment: ' + (json.message || '')); return;
      }
      await loadComments();
    }

    // Wire up
    document.addEventListener('DOMContentLoaded', () => {
      $('#apiKey').value = getKey();
      $('#saveKey').addEventListener('click', () => { setKey($('#apiKey').value.trim()); alert('API key saved locally.'); });
      $('#loadBtn').addEventListener('click', loadComments);
      $('#status').addEventListener('change', loadComments);
      $('#page').addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); loadComments(); }});
      $('#q').addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); loadComments(); }});
      loadComments();
    });
  </script>
<footer class="bg-dark text-white py-5">
    <div class="container">
      <div class="row g-4">
        <div class="col-lg-4">
          <div class="d-flex align-items-center mb-3">
            <img src="https://gisusafaris.com/img/gisu_safaris.png" alt="Gisu Safaris Logo" class="footer-logo me-2">
            <h5 class="mb-0">Gisu Safaris</h5>
          </div>
          <p class="mb-3">East Africa's premier safari company specializing in wildlife adventures and meaningful community experiences.</p>
          <div class="contact-info">
            <p class="mb-2"><i class="fas fa-envelope me-2"></i><a href="mailto:info@gisusafaris.com" class="text-light text-decoration-none">info@gisusafaris.com</a></p>
            <p class="mb-2"><i class="fas fa-phone me-2"></i>
              <img src="https://flagcdn.com/ug.svg" alt="Uganda flag" class="flag-icon me-1" loading="lazy">
              <a href="tel:+256703466516" class="text-light text-decoration-none">+256 703 466 516</a>
            </p>
            <p class="mb-2"><i class="fas fa-phone me-2"></i>
              <img src="https://flagcdn.com/au.svg" alt="Australia flag" class="flag-icon me-1" loading="lazy">
              <a href="tel:+61478914106" class="text-light text-decoration-none">+614 7891 4106</a>
            </p>
            <p class="mb-2"><i class="fas fa-phone me-2"></i>
              <img src="https://flagcdn.com/gb.svg" alt="United Kingdom flag" class="flag-icon me-1" loading="lazy">
              <a href="tel:+447350538108" class="text-light text-decoration-none">+44 7350 538 108</a>
            </p>
            <p class="mb-0"><i class="fas fa-map-marker-alt me-2"></i>Kampala, Uganda</p>
          </div>
        </div>
        <div class="col-lg-2">
          <h6 class="mb-3">Quick Links</h6>
          <ul class="list-unstyled">
            <li class="mb-2"><a href="/index.html" class="text-light text-decoration-none">Home</a></li>
            <li class="mb-2"><a href="/about.html" class="text-light text-decoration-none">About Us</a></li>
            <li class="mb-2"><a href="/packages/index.html" class="text-light text-decoration-none">Safari Packages</a></li>
            <li class="mb-2"><a href="/destinations/index.html" class="text-light text-decoration-none">Destinations</a></li>
            <li class="mb-2"><a href="/gallery.html" class="text-light text-decoration-none">Gallery</a></li>
            <li class="mb-2"><a href="/contact.html" class="text-light text-decoration-none">Contact</a></li>
          </ul>
        </div>
        <div class="col-lg-3">
          <h6 class="mb-3">Safari Destinations</h6>
          <ul class="list-unstyled">
            <li class="mb-2"><a href="/packages/uganda.html" class="text-light text-decoration-none"><i class="fas fa-leaf me-2"></i>Uganda Safaris</a></li>
            <li class="mb-2"><a href="/packages/kenya.html" class="text-light text-decoration-none"><i class="fas fa-paw me-2"></i>Kenya Safaris</a></li>
            <li class="mb-2"><a href="/packages/tanzania.html" class="text-light text-decoration-none"><i class="fas fa-mountain me-2"></i>Tanzania Safaris</a></li>
            <li class="mb-2"><a href="/packages/rwanda.html" class="text-light text-decoration-none"><i class="fas fa-users me-2"></i>Rwanda Safaris</a></li>
          </ul>
        </div>
        <div class="col-lg-3">
          <h6 class="mb-3">Connect With Us</h6>
          <div class="social-icons mb-3">
            <a href="https://www.facebook.com/GisuSafaris" class="text-light me-3" target="_blank"><i class="fab fa-facebook fa-lg"></i></a>
            <a href="https://www.instagram.com/gisu_safaris" class="text-light me-3" target="_blank"><i class="fab fa-instagram fa-lg"></i></a>
            <a href="https://x.com/GisuSafaris" class="text-light me-3" target="_blank"><i class="fab fa-x fa-lg"></i></a>
            <a href="https://www.youtube.com/c/GisuSafaris" class="text-light me-3" target="_blank"><i class="fab fa-youtube fa-lg"></i></a>
            <a href="https://wa.me/61478914106" class="text-light" target="_blank"><i class="fab fa-whatsapp fa-lg"></i></a>
          </div>
          <div class="newsletter">
            <h6>Newsletter</h6>
            <form class="newsletter-form" id="footerNewsletterForm">
              <div class="input-group mb-2">
                <input type="email" class="form-control" name="email" placeholder="Your email" required>
                <button class="btn btn-primary" type="submit"><i class="fas fa-paper-plane"></i></button>
              </div>
              <small class="text-muted">Get safari tips & exclusive offers</small>
            </form>
          </div>
        </div>
      </div>
      <hr class="my-4">
      <div class="row align-items-center">
        <div class="row align-items-center">
          <div class="col-md-8"><p class="mb-0">&copy; 2025 Gisu Safaris. All rights reserved.</p></div>
          <div class="col-md-4 text-md-end"><p class="mb-0">Designed by <strong>Kairos Technologies</strong></p></div>
        </div>
        <div class="col-md-7 text-md-end">
          <a href="/privacy.html" class="text-white-50 text-decoration-none me-3">Privacy Policy</a>
          <a href="/terms.html" class="text-white-50 text-decoration-none">Terms of Service</a>
        </div>
      </div>
    </div>
  </footer>
</body>
</html>


